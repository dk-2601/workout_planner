<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sam Fitness Studio ‚Äì Workout Planner</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0a63c9" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- iOS PWA support -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Workout Planner" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <style>
    :root {
      --brand: #0a63c9; --bg: #f9f9fb; --card: #ffffff;
      --text: #333; --muted: #666; --border: #e6e6ef;
    }
    * { box-sizing: border-box; }
    body { font-family: "Segoe UI", Arial, sans-serif; background: var(--bg); margin: 0; color: var(--text); }
    .brandbar { background: var(--brand); color: #fff; padding: 16px 20px; text-align: center; font-weight: 700; font-size: 18px; }
    .container { max-width: 640px; margin: 18px auto 40px; padding: 0 16px; }
    .card { background: var(--card); padding: 18px; margin-bottom: 16px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,.06); border: 1px solid var(--border); }
    h2 { margin: 0 0 10px; font-size: 20px; color: #111; }
    label { display: block; font-weight: 600; margin: 10px 0 6px; color: #444; }
    input, select, textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: #fff; font-size: 14px; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { border: 1px solid #eee; padding: 8px; text-align: center; font-size: 14px; }
    th { background: #f1f4fa; font-weight: 700; }
    .btn-row { text-align: center; margin-top: 8px; }
    button { background: var(--brand); color: #fff; border: none; padding: 12px 18px; border-radius: 10px; font-size: 15px; cursor: pointer; margin: 6px 4px; transition: transform .03s ease, opacity .2s ease; }
    button:active { transform: scale(.98); }
    button.secondary { background: #0a7d45; }
    .plan-card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 12px; margin-bottom: 10px; box-shadow: 0 2px 6px rgba(0,0,0,.04); }
    .plan-card h4 { margin: 0 0 6px; color: var(--brand); }
    .muted { color: var(--muted); font-size: 13px; }
  </style>
</head>
<body>
<div class="brandbar">Sam Fitness Studio</div>
<div class="container">

<!-- Client Info -->
<div class="card">
  <h2>Client Information</h2>
  <label>Name</label>
  <input type="text" id="clientName" placeholder="Enter client name" />
  <label>Age</label>
  <input type="number" id="clientAge" min="1" max="120" placeholder="Enter age" />
  <label>Gender</label>
  <select id="gender"><option value="">-- Select Gender --</option><option>Male</option><option>Female</option><option>Other</option></select>
  <label>Goal</label>
  <input type="text" id="goal" placeholder="e.g. Weight Loss, Muscle Gain" />
  <label>Current Weight (kg)</label>
  <input type="number" id="currentWeight" placeholder="Enter current weight" />
  <label>Ideal Weight (kg)</label>
  <input type="number" id="idealWeight" placeholder="Enter ideal weight" />
  <label>WhatsApp Number</label>
  <input type="tel" id="whatsappNumber" placeholder="Enter WhatsApp number (without +91)" />
  <label>Address</label>
  <textarea id="address" placeholder="Enter address"></textarea>
  <label>Start Date</label>
  <input type="date" id="startDate" />
  <label>End Date</label>
  <input type="date" id="endDate" />

  <div class="btn-row">
    <button onclick="saveClient()">üíæ Save Client</button>
    <button type="button" onclick="sendWhatsApp()">üì© Send WhatsApp Reminder</button>
  </div>
</div>

<!-- Day & Muscle Selection -->
<div class="card">
  <label>Select Day</label>
  <select id="daySelect"><option>Day 1</option><option>Day 2</option><option>Day 3</option><option>Day 4</option><option>Day 5</option><option>Day 6</option><option>Day 7</option></select>
  <label>Muscle Group</label>
  <select id="muscleGroup" onchange="showExercises()"><option value="">-- Select --</option><option>Chest</option><option>Back</option><option>Biceps</option><option>Triceps</option><option>Legs</option><option>Shoulders</option><option>Functional</option><option>Rest</option></select>
  <div id="exerciseTable"></div>
  <div class="btn-row"><button onclick="addToPlan()">‚ûï Add to Plan</button></div>
</div>

<!-- Draft Plan -->
<div class="card"><h2>Plan (Draft)</h2><div id="planList"></div></div>

<!-- Actions -->
<div class="btn-row">
  <button onclick="generatePDF('download')">‚¨áÔ∏è Download PDF</button>
  <button class="secondary" onclick="generatePDF('share')">üì§ Share PDF</button>
</div>

</div>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>

<script>
const exerciseOptions = {
  "Chest":["Bench Press","Incline Press","Dumbbell Fly"],
  "Back":["Pull Ups","Lat Pulldown","Deadlift"],
  "Biceps":["Barbell Curl","Hammer Curl","Concentration Curl"],
  "Triceps":["Close Grip Bench","Skull Crusher","Tricep Dips"],
  "Legs":["Squats","Lunges","Leg Press"],
  "Shoulders":["Overhead Press","Lateral Raises","Arnold Press"],
  "Functional":["Burpees","Plank","Mountain Climbers"]
};
let workoutPlan = {};

// === UI: Exercises and Plan ===
function showExercises(){ const g=document.getElementById("muscleGroup").value, c=document.getElementById("exerciseTable"); c.innerHTML=""; if(!g||g==="Rest")return; let h="<table><tr><th>Exercise</th><th>Sets</th><th>Reps</th></tr>"; exerciseOptions[g].forEach(ex=>{h+=`<tr><td>${ex}</td><td><input type="number" id="sets_${ex}" style="width:70px"></td><td><input type="number" id="reps_${ex}" style="width:70px"></td></tr>`}); h+="</table>"; c.innerHTML=h;}
function addToPlan(){const d=document.getElementById("daySelect").value,g=document.getElementById("muscleGroup").value;if(!d||!g)return;workoutPlan[d]=workoutPlan[d]||{};if(g==="Rest"){workoutPlan[d]["Rest"]=[]}else{const it=exerciseOptions[g].map(ex=>({name:ex,sets:document.getElementById(`sets_${ex}`)?.value.trim(),reps:document.getElementById(`reps_${ex}`)?.value.trim()})).filter(x=>x.sets&&x.reps);if(it.length)workoutPlan[d][g]=it;}renderDraft();}
function renderDraft(){const w=document.getElementById("planList");w.innerHTML="";Object.keys(workoutPlan).forEach(d=>{const card=document.createElement("div");card.className="plan-card";card.innerHTML=`<h4>${d}</h4>`;const gs=workoutPlan[d];if(Object.keys(gs).length===0)card.innerHTML+="<div class='muted'>No entries yet.</div>";Object.keys(gs).forEach(g=>{if(g==="Rest")card.innerHTML+="<b>Rest</b><br><span class='muted'>Rest Day</span><br>";else{card.innerHTML+=`<b>${g}</b><br>`;gs[g].forEach(ex=>card.innerHTML+=`${ex.name}: ${ex.sets}√ó${ex.reps}<br>`);}});w.appendChild(card);});}

// === Save Client ===
function saveClient(){const c={name:clientName.value.trim(),age:clientAge.value.trim(),gender:gender.value.trim(),goal:goal.value.trim(),currentWeight:currentWeight.value.trim(),idealWeight:idealWeight.value.trim(),address:address.value.trim(),whatsapp:whatsappNumber.value.trim(),createdDate:new Date().toLocaleDateString()};fetch("https://script.google.com/macros/s/AKfycbzx6kDL2Eu8f0i4YBirEXSv14UIbTTKwOJlPFc1wxaxws1Dn-XGGEyY4XdDw6fNm3tS1A/exec",{method:"POST",body:JSON.stringify(c)}).then(r=>r.json()).then(d=>alert("Saved ‚úÖ")).catch(e=>alert("Error: "+e));}

// === WhatsApp Messaging ===
function sendWhatsApp(){const phone=whatsappNumber.value.trim(),n=clientName.value.trim();if(!phone){alert("Enter WhatsApp number");return;}const msg=`Hello ${n||"Client"}, this is a reminder from Sam Fitness Studio. Stay consistent with your plan! üí™`;window.open("https://wa.me/91"+phone+"?text="+encodeURIComponent(msg),"_blank");}

// === PDF Generation (unified tables from old version) ===
function getTableStyle(){return{theme:"grid",styles:{fontSize:11,cellPadding:4,lineColor:[220,220,230],lineWidth:.4,valign:"middle"},headStyles:{fillColor:[10,99,201],textColor:255,fontStyle:"bold"},columnStyles:{group:{cellWidth:45},exercise:{cellWidth:125}},margin:{left:20,right:20}};}
async function generatePDF(action){const{jsPDF}=window.jspdf,doc=new jsPDF({unit:"mm",format:"a4"});const name=(clientName.value||"Client").trim(),age=(clientAge.value||"-").trim(),sDate=startDate.value||"-",eDate=endDate.value||"-";doc.setFontSize(18);doc.text("Sam Fitness Studio",105,15,{align:"center"});doc.setFontSize(13);doc.text("Workout Plan",105,22,{align:"center"});doc.autoTable({startY:30,head:[["Name","Age"]],body:[[name,age]],...getTableStyle(),columnStyles:{0:{cellWidth:95},1:{cellWidth:95}}});doc.autoTable({startY:doc.lastAutoTable.finalY+4,head:[["Start Date","End Date"]],body:[[sDate,eDate]],...getTableStyle(),columnStyles:{0:{cellWidth:95},1:{cellWidth:95}}});let y=doc.lastAutoTable.finalY+10;Object.keys(workoutPlan).forEach(day=>{if(y>275){doc.addPage();y=20;}doc.setFontSize(14);doc.text(day,20,y);y+=4;const rows=[];const gs=workoutPlan[day]||{};if(Object.keys(gs).length===0){rows.push({group:"‚Äî",exercise:"No entries"})}else{Object.keys(gs).forEach(g=>{if(g==="Rest")rows.push({group:"Rest Day",exercise:"‚Äî"});else gs[g].forEach(ex=>rows.push({group:g,exercise:`${ex.name}: ${ex.sets}√ó${ex.reps}`}));});}doc.autoTable({startY:y+2,columns:[{header:"Muscle Group",dataKey:"group"},{header:"Exercise",dataKey:"exercise"}],body:rows,...getTableStyle()});y=doc.lastAutoTable.finalY+10;});const fileName=`${name.replace(/\s+/g,"_")}_WorkoutPlan.pdf`;if(action==="download")doc.save(fileName);else if(action==="share"){const pdfBlob=doc.output("blob"),file=new File([pdfBlob],fileName,{type:"application/pdf"});if(navigator.share&&navigator.canShare&&navigator.canShare({files:[file]})){try{await navigator.share({title:"Workout Plan",text:"Workout plan from Sam Fitness Studio",files:[file]})}catch(e){downloadFallback(pdfBlob,fileName)}}else downloadFallback(pdfBlob,fileName);} }
function downloadFallback(blob,fileName){const url=URL.createObjectURL(blob),a=document.createElement("a");a.href=url;a.download=fileName;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);}

// === Send PDF via WhatsApp ===
async function sendPDFtoWhatsApp(){const phone=whatsappNumber.value.trim();if(!phone){alert("Enter WhatsApp number");return;}const{jsPDF}=window.jspdf;const doc=new jsPDF();doc.setFontSize(16);doc.text("Sam Fitness Studio - Workout Plan",10,10);doc.setFontSize(12);doc.text(`Name: ${clientName.value||"Client"}`,10,20);doc.text(`Goal: ${goal.value||"-"}`,10,28);let y=38;Object.keys(workoutPlan).forEach(d=>{doc.setFont(undefined,"bold");doc.text(d,10,y);y+=6;Object.keys(workoutPlan[d]).forEach(g=>{doc.setFont(undefined,"normal");if(g==="Rest"){doc.text("Rest Day",12,y);y+=6;return;}doc.text(g,12,y);y+=6;workoutPlan[d][g].forEach(ex=>{doc.text(`${ex.name}: ${ex.sets}√ó${ex.reps}`,14,y);y+=6;});});y+=4;});const pdfBlob=doc.output("blob");const reader=new FileReader();reader.onloadend=async function(){const base64=reader.result.split(",")[1];const payload={fileBase64:base64,fileName:`WorkoutPlan_${clientName.value||"client"}.pdf`};try{const res=await fetch("YOUR_GOOGLE_SCRIPT_UPLOAD_URL",{method:"POST",body:JSON.stringify(payload)});const data=await res.json();if(data.link){const msg=`Hello ${clientName.value||"Client"}, your workout plan is ready:\n${data.link}`;window.open("https://wa.me/91"+phone+"?text="+encodeURIComponent(msg),"_blank");}else alert("Upload error: "+(data.error||"Unknown"));}catch(e){alert("Upload failed: "+e);} };reader.readAsDataURL(pdfBlob);}
</script>

<script>
if("serviceWorker" in navigator){window.addEventListener("load",()=>{navigator.serviceWorker.register("service-worker.js").then(r=>console.log("‚úÖ Service Worker registered")).catch(e=>console.log("‚ùå SW error:",e));});}
</script>
</body>
</html>
